<!DOCTYPE html>
{% load static %}
{% load i18n %}
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" %} - Barbershop</title>
    <link rel="stylesheet" href="{% static 'booking/css/dashboard.css' %}">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="{% url 'home' %}" class="logo">BARBERSHOP</a>
            <nav class="header-nav" id="dashNav">
                <a href="{% url 'home' %}" class="nav-btn">{% trans "–ù–∞ –≥–ª–∞–≤–Ω—É—é" %}</a>
                <a href="{% url 'logout' %}" class="nav-btn logout">{% trans "–í—ã–π—Ç–∏" %}</a>
                {% with current_lang=LANGUAGE_CODE|slice:":2" %}
                    <form action="{% url 'set_language' %}" method="post" class="lang-switcher">
                        {% csrf_token %}
                        <input type="hidden" name="next" value="{{ request.path }}">
                        <button type="submit" name="language" value="ru" class="lang-btn{% if current_lang == 'ru' %} active{% endif %}">RU</button>
                        <button type="submit" name="language" value="uk" class="lang-btn{% if current_lang == 'uk' %} active{% endif %}">UA</button>
                        <button type="submit" name="language" value="en" class="lang-btn{% if current_lang == 'en' %} active{% endif %}">EN</button>
                    </form>
                {% endwith %}
            </nav>
            <button class="burger" id="burger" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <main>
        <div class="page-header">
            <h1>{% trans "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" %}</h1>
            <p>{% trans "–í–∞—à–∏ –∑–∞–ø–∏—Å–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–∞–º–∏" %}</p>
        </div>

        <!-- Profile Card -->
        <div class="profile-card">
            <h2>üë§ {% trans "–ü—Ä–æ—Ñ–∏–ª—å" %}</h2>
            <div class="profile-info">
                <p><strong>{% trans "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫:" %}</strong> {{ request.user.username }}</p>
                {% if request.user.first_name or request.user.last_name %}
                <p><strong>{% trans "–ò–º—è:" %}</strong> {{ request.user.first_name }} {{ request.user.last_name }}</p>
                {% endif %}
                {% if request.user.email %}
                <p><strong>Email:</strong> {{ request.user.email }}</p>
                {% endif %}
                {% if request.user.profile.phone %}
                <p><strong>{% trans "–¢–µ–ª–µ—Ñ–æ–Ω:" %}</strong> {{ request.user.profile.phone }}</p>
                {% endif %}
            </div>
            <div class="profile-actions">
                <a href="{% url 'edit_profile' %}" class="btn btn-success">{% trans "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å" %}</a>
            </div>
        </div>

        <section class="section">
            <h2 class="section-title">{% trans "–ú–æ–∏ –∑–∞–ø–∏—Å–∏" %}</h2>

            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="message message-{{ message.tags|default:'info' }}">
                            <span class="message-icon">
                                {% if 'success' in message.tags %}‚úÖ{% elif 'error' in message.tags %}‚ö†Ô∏è{% elif 'warning' in message.tags %}‚ö†Ô∏è{% else %}‚ÑπÔ∏è{% endif %}
                            </span>
                            <span class="message-text">{{ message }}</span>
                            <button type="button" class="message-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å" onclick="this.parentElement.remove()">√ó</button>
                        </div>
                    {% endfor %}
                </div>
                <script>
                    document.querySelectorAll('.messages .message').forEach(function (msg) {
                        setTimeout(function () {
                            msg.classList.add('message-hide');
                            msg.addEventListener('animationend', function () { msg.remove(); }, { once: true });
                        }, 4000);
                    });
                </script>
            {% endif %}

            {% if bookings %}
                <div class="bookings-grid">
                    {% for b in bookings %}
                        <div class="booking-card">
                            <div class="booking-header">
                                <div class="booking-service">{{ b.service.name }}</div>
                                <span class="booking-status status-{{ b.status }}">{{ b.get_status_display }}</span>
                            </div>
                            <div class="booking-details">
                                <div class="booking-detail">
                                    <span class="icon">üìÜ</span>
                                    <span>{% trans "–î–∞—Ç–∞:" %} <strong>{{ b.booking_date|date:"d.m.Y" }}</strong></span>
                                </div>
                                <div class="booking-detail">
                                    <span class="icon">üïê</span>
                                    <span>{% trans "–í—Ä–µ–º—è:" %} <strong>{{ b.booking_time|time:"H:i" }}</strong></span>
                                </div>
                                <div class="booking-detail">
                                    <span class="icon">üë®‚Äçü¶≤</span>
                                    <span>{% trans "–ë–∞—Ä–±–µ—Ä:" %} <strong>{{ b.barber.name }}</strong></span>
                                </div>
                                <div class="booking-detail">
                                    <span class="icon">üíà</span>
                                    <span>{% trans "–£—Å–ª—É–≥–∞:" %} <strong>{{ b.service.name }}</strong> ({{ b.service.price }} ‚Ç¥)</span>
                                </div>
                            </div>

                            {% if b.status != "canceled" and b.status != "completed" and b.status != "no_show" %}
                                <div class="booking-actions">
                                    <a href="{% url 'booking_reschedule' b.id %}" class="btn btn-secondary">{% trans "–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏" %}</a>
                                    <form method="post" action="{% url 'cancel_booking' b.id %}" onsubmit="return confirm('{% trans "–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å?" %}')">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-danger">{% trans "–û—Ç–º–µ–Ω–∏—Ç—å" %}</button>
                                    </form>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div> 
            {% else %}
                <p class="empty">{% trans "–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π." %}</p>
            {% endif %}
        </section>

        <!-- Upcoming Bookings -->
        <section class="section">
            <h2 class="section-title">üìÖ {% trans "–ú–æ–∏ –±—É–¥—É—â–∏–µ –∑–∞–ø–∏—Å–∏" %}</h2>
            {% if upcoming_bookings %}
                <div class="bookings-grid">
                    {% for b in upcoming_bookings %}
                    <div class="booking-card">
                        <div class="booking-header">
                            <div class="booking-service">{{ b.service.name }}</div>
                            <span class="booking-status status-{{ b.status }}">{{ b.get_status_display }}</span>
                        </div>
                        <div class="booking-details">
                            <div class="booking-detail">
                                <span class="icon">üë®‚Äçü¶≤</span>
                                <span>{% trans "–ë–∞—Ä–±–µ—Ä:" %} <strong>{{ b.barber.name }}</strong></span>
                            </div>
                            <div class="booking-detail">
                                <span class="icon">üìÜ</span>
                                <span>{% trans "–î–∞—Ç–∞:" %} <strong>{{ b.booking_date|date:"d.m.Y" }}</strong></span>
                            </div>
                            <div class="booking-detail">
                                <span class="icon">üïê</span>
                                <span>{% trans "–í—Ä–µ–º—è:" %} <strong>{{ b.booking_time|time:"H:i" }}</strong></span>
                            </div>
                            <div class="booking-detail">
                                <span class="icon">üí∞</span>
                                <span>{% trans "–¶–µ–Ω–∞:" %} <strong>{{ b.service.price }} ‚Ç¥</strong></span>
                            </div>
                        </div>
                        {% if b.status != "canceled" and b.status != "completed" and b.status != "no_show" %}
                            <div class="booking-actions">
                                <a href="{% url 'booking_reschedule' b.id %}" class="btn btn-secondary">{% trans "–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏" %}</a>
                                <form method="post" action="{% url 'cancel_booking' b.id %}" onsubmit="return confirm('{% trans "–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å?" %}')">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger">{% trans "–û—Ç–º–µ–Ω–∏—Ç—å" %}</button>
                                </form>
                            </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="empty">
                    üì≠ {% trans "–ü–æ–∫–∞ –Ω–µ—Ç –±—É–¥—É—â–∏—Ö –∑–∞–ø–∏—Å–µ–π." %}<br>
                    <small>{% trans "–°–∞–º–æ–µ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É!" %}</small>
                </p>
            {% endif %}
        </section>

        <!-- Past Bookings -->
        <section class="section">
            <h2 class="section-title">üìú {% trans "–ü—Ä–æ—à–ª—ã–µ –∑–∞–ø–∏—Å–∏" %}</h2>
            {% if past_bookings %}
                <div class="bookings-grid">
                    {% for b in past_bookings %}
                    <div class="booking-card past">
                        <div class="booking-header">
                            <div class="booking-service">{{ b.service.name }}</div>
                            <span class="booking-status status-{{ b.status }}">{{ b.get_status_display }}</span>
                        </div>
                        <div class="booking-details">
                            <div class="booking-detail">
                                <span class="icon">üë®‚Äçü¶≤</span>
                                <span>{% trans "–ë–∞—Ä–±–µ—Ä:" %} <strong>{{ b.barber.name }}</strong></span>
                            </div>
                            <div class="booking-detail">
                                <span class="icon">üìÜ</span>
                                <span>{% trans "–î–∞—Ç–∞:" %} <strong>{{ b.booking_date|date:"d.m.Y" }}</strong></span>
                            </div>
                            <div class="booking-detail">
                                <span class="icon">üïê</span>
                                <span>{% trans "–í—Ä–µ–º—è:" %} <strong>{{ b.booking_time|time:"H:i" }}</strong></span>
                            </div>
                            <div class="booking-detail">
                                <span class="icon">üí∞</span>
                                <span>{% trans "–¶–µ–Ω–∞:" %} <strong>{{ b.service.price }} ‚Ç¥</strong></span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="empty">
                    üì≠ {% trans "–ü—Ä–æ—à–ª—ã—Ö –∑–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç." %}
                </p>
            {% endif %}
        </section>

        <!-- CTA -->
        <section class="cta-section">
            <h3>‚úÇÔ∏è {% trans "–•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è —Å–Ω–æ–≤–∞?" %}</h3>
            <p>{% trans "–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –∏ –ª—é–±–∏–º–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞" %}</p>
            <a href="{% url 'home' %}#booking" class="cta-btn">{% trans "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è —Å–µ–π—á–∞—Å" %}</a>
        </section>
    </main>

    <script>
        (function() {
            const burger = document.getElementById('burger');
            const nav = document.getElementById('dashNav');
            if (!burger || !nav) return;
            burger.addEventListener('click', () => {
                nav.classList.toggle('active');
                burger.classList.toggle('active');
            });
            nav.querySelectorAll('a, button').forEach(el => {
                el.addEventListener('click', () => {
                    nav.classList.remove('active');
                    burger.classList.remove('active');
                });
            });
        })();
    </script>
</body>
</html>
